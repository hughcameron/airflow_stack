kind: pipeline
name: default

clone:
  depth: 50

steps:
- name: compose up
  image: docker:dind
  secrets: [DOCKER_SOCKET,DOMAIN,IP_RANGE,TIMEZONE,AIRFLOW_EMAIL,AIRFLOW_USER,AIRFLOW_FIRSTNAME,AIRFLOW_LASTNAME,AIRFLOW_PASSWORD,AIRFLOW_FERNET_KEY,AIRFLOW_DATABASE_NAME,AIRFLOW_DATABASE_USERNAME,AIRFLOW_DATABASE_PASSWORD,WAREHOUSE_NAME,WAREHOUSE_USERNAME,WAREHOUSE_PASSWORD,MINIO_ACCESS_KEY,MINIO_SECRET_KEY]
  volumes:
  - name: dockersock
    path: /var/run/docker.sock
  commands:
    - docker-compse down
    - docker volume rm airflow_data
    - docker volume rm airflow_worker_data
    - docker volume rm minio_data
    - docker volume rm redis_data
    - docker volume rm warehouse_data
    - docker-compose up -d

volumes:
- name: dockersock
  host:
    path: /volume1/docker/config/docker.sock


